---
import '@splidejs/splide/dist/css/splide.min.css';
import { categories } from '../lib/categories';
import SearchBar from './SearchBar.astro';
import { supabase } from '../lib/supabase';

// Get current path
const currentPath = Astro.url.pathname;
const isHomePage = currentPath === '/';

// Fetch latest articles for breaking news
const { data: breakingNewsArticles } = await supabase
  .from('articles')
  .select('id, title, slug, category_slug')
  .eq('isdraft', false)
  .order('published_at', { ascending: false })
  .limit(3);

// Fetch featured articles
const { data: featuredArticles } = await supabase
  .from('articles')
  .select('*')
  .eq('is_featured', true)
  .eq('isdraft', false)
  .order('published_at', { ascending: false })
  .limit(3);

// Transform featured articles for the slider
const featuredNews = featuredArticles?.map(article => ({
  title: article.title,
  image: article.image_url,
  category: article.category,
  subcategory: '',
  excerpt: article.excerpt,
  href: `/${article.category_slug}/${article.slug}` // Updated href format
})) || [];
---

<header class="bg-white" id="main-header">
  <!-- Breaking News Ticker -->
  <div class="bg-breaking text-white py-2 relative overflow-hidden">
    <div class="container mx-auto px-4">
      <div class="flex items-center">
        <span class="font-bold text-sm px-3 py-1 bg-white text-primary mr-4">ULTIMA ORA</span>
        <div class="breaking-news-ticker overflow-hidden flex-1" id="breaking-news">
          <div class="flex whitespace-nowrap animate-ticker">
            {breakingNewsArticles?.map(article => (
              <a 
                href={`/${article.category_slug}/${article.slug}`} // Updated href format
                class="inline-block px-8 hover:text-breaking-light transition-colors duration-200"
              >
                {article.title}
              </a>
            ))}
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Top bar -->
  <div class="bg-sport-500 text-white">
    <div class="container mx-auto px-4">
      <div class="flex justify-between items-center h-10">
        <div class="flex items-center space-x-4" id="auth-section">
          <!-- This will be populated by JavaScript -->
          <div class="text-sm">Loading...</div>
        </div>
        <div class="flex items-center space-x-4">
          <SearchBar />
          <div id="logout-button-container">
            <!-- This will be populated by JavaScript -->
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Logo and Date Section -->
  <div class="border-b border-gray-200">
    <div class="container mx-auto px-4 py-6">
      <div class="grid grid-cols-3 items-center">
        <!-- Left - Date -->
        <div class="hidden md:flex items-center">
          <div class="flex items-center gap-3 group cursor-pointer">
            <!-- Calendar Icon -->
            <div class="relative w-14 h-14 flex-shrink-0 transition-transform duration-300 group-hover:scale-105">
              <div class="absolute inset-0 bg-sport-500/10 rounded-lg transform rotate-3 transition-all duration-300 group-hover:rotate-6 group-hover:bg-sport-500/20"></div>
              <div class="absolute inset-0 bg-white rounded-lg border-2 border-sport-500 flex flex-col items-center justify-center transition-transform duration-300 group-hover:shadow-lg">
                <span class="text-xs font-bold text-sport-500 uppercase transition-colors duration-300 group-hover:text-sport-700">
                  {new Date().toLocaleString('it-IT', { weekday: 'short' })}
                </span>
                <span class="text-xl font-bold text-gray-800 transition-colors duration-300 group-hover:text-sport-500">
                  {new Date().getDate()}
                </span>
              </div>
            </div>

            <!-- Date Text -->
            <div class="flex flex-col transition-transform duration-300 group-hover:translate-x-1">
              <span class="text-2xl font-bold text-gray-800 leading-tight capitalize transition-colors duration-300 group-hover:text-sport-500">
                {new Date().toLocaleString('it-IT', { weekday: 'long' })}
              </span>
              <span class="text-lg text-gray-600 transition-colors duration-300 group-hover:text-gray-800">
                {new Date().toLocaleString('it-IT', { 
                  day: 'numeric',
                  month: 'long',
                  year: 'numeric'
                })}
              </span>
            </div>
          </div>
        </div>

        <!-- Center - Logo -->
        <div class="flex justify-center col-span-3 md:col-span-1">
          <a href="/" class="group" aria-label="EduNews24 Logo">
            <svg width="272" height="53" viewBox="0 0 209 41" fill="none" xmlns="http://www.w3.org/2000/svg">
              <title>EduNews24</title>
              
              <g class="animate-logo-entrance-left">
                <rect width="85.7172" height="38.335" transform="matrix(1 0 -0.13191 0.991262 5.05679 3)" fill="#064C99"/>
                <path d="M20.1533 23.9583L19.4479 27.7939H31.0279L30.1706 32.4558H12.9806L16.8438 11.448H33.7338L32.8928 16.0214H21.6128L20.978 19.4735H30.878L30.0533 23.9583H20.1533ZM37.088 11.448H46.088C49.408 11.448 51.7716 12.3529 53.1788 14.1625C54.586 15.9722 54.9785 18.5686 54.3564 21.9519C53.7451 25.2762 52.4394 27.8628 50.4394 29.7118C48.443 31.5411 45.8448 32.4558 42.6448 32.4558H33.2248L37.088 11.448ZM39.6866 27.8235H42.5366C45.9566 27.8235 48.0265 25.8663 48.7464 21.9519C49.1189 19.9259 48.9539 18.4309 48.2511 17.4671C47.572 16.4836 46.2924 15.9918 44.4124 15.9918H41.8624L39.6866 27.8235ZM64.3984 33.1344C61.4584 33.1344 59.3232 32.4558 57.9928 31.0985C56.6624 29.7413 56.2305 27.7939 56.6971 25.2565L59.2364 11.448H64.8464L62.3017 25.286C61.8929 27.5087 62.8786 28.6201 65.2586 28.6201C67.6186 28.6201 69.0029 27.5087 69.4117 25.286L71.9564 11.448H77.5664L75.0271 25.2565C74.5569 27.8136 73.407 29.7708 71.5774 31.128C69.7514 32.4656 67.3584 33.1344 64.3984 33.1344Z" fill="white"/>
              </g>
              
              <g class="animate-logo-entrance-right">
                <rect x="0.901028" y="0.99509" width="124.417" height="28.148" transform="matrix(1 0 -0.0989724 0.99509 82.0823 7.00489)" fill="white" stroke="#064C99" stroke-width="2"/>
                <path d="M109.202 22.9167L110.226 14.7003H113.906L112.144 28.8308H108.404L104.484 20.6542L103.464 28.8308H99.7638L101.526 14.7003H105.226L109.202 22.9167ZM119.1 23.1151L118.778 25.6951H126.498L126.107 28.8308H114.647L116.409 14.7003H127.669L127.285 17.7765H119.765L119.476 20.0985H126.076L125.7 23.1151H119.1ZM142.25 20.9122L144.605 14.7003H148.345L142.443 28.8308H138.843L138.069 19.8008L135.123 28.8308H131.443L129.065 14.7003H132.845L133.65 20.9122L133.892 24.2662L134.89 20.9122L137.005 14.7003H140.445L141.05 20.9122L141.2 24.2067L142.25 20.9122ZM153.944 29.2873C152.037 29.2873 150.591 28.8573 149.605 27.9973C148.62 27.1241 148.188 25.887 148.308 24.286H152.008C151.933 25.6356 152.729 26.3104 154.395 26.3104C155.849 26.3104 156.634 25.8407 156.751 24.9013C156.797 24.5308 156.699 24.2464 156.457 24.0479C156.231 23.8362 155.82 23.651 155.227 23.4922L152.508 22.8373C150.126 22.2683 149.067 20.9254 149.331 18.8085C149.493 17.5119 150.099 16.4468 151.15 15.6133C152.2 14.7797 153.665 14.3629 155.545 14.3629C157.345 14.3629 158.703 14.7599 159.617 15.5537C160.533 16.3343 160.941 17.4457 160.841 18.8879H157.221C157.2 17.7765 156.516 17.2208 155.169 17.2208C154.582 17.2208 154.101 17.3399 153.724 17.578C153.363 17.803 153.158 18.1073 153.111 18.491C153.036 19.0863 153.438 19.4965 154.317 19.7214L157.153 20.3962C159.715 21.018 160.859 22.4337 160.583 24.6433C160.402 26.0987 159.72 27.2365 158.537 28.0568C157.355 28.8771 155.824 29.2873 153.944 29.2873ZM178.666 28.8308H167.386C167.542 27.5739 167.947 26.5221 168.599 25.6753C169.248 24.855 170.361 23.9487 171.938 22.9564L174.332 21.4083C174.939 21.0247 175.378 20.6608 175.648 20.3168C175.931 19.9728 176.099 19.5825 176.154 19.1459C176.225 18.577 176.107 18.1337 175.8 17.8162C175.494 17.4854 175.041 17.32 174.441 17.32C173.081 17.32 172.303 18.1073 172.107 19.6817L172.07 19.9794H168.69L168.744 19.5428C168.947 17.9154 169.586 16.6453 170.66 15.7323C171.733 14.8194 173.15 14.3629 174.91 14.3629C176.59 14.3629 177.873 14.7665 178.759 15.5736C179.657 16.3939 180.018 17.5119 179.841 18.9276C179.727 19.8405 179.385 20.6608 178.814 21.3885C178.257 22.1162 177.417 22.8108 176.294 23.4724L173.641 25.0204C173.136 25.3247 172.851 25.5827 172.784 25.7944H179.044L178.666 28.8308ZM192.971 14.6805L191.929 23.0357L194.014 22.996L193.665 25.7944L191.572 25.7348L191.183 28.8507H187.703L188.092 25.7348L181.505 25.7944L181.906 22.5793L189.331 14.6805H192.971ZM184.669 23.0357H188.429L188.988 18.5505H188.928L184.669 23.0357Z" fill="#064C99"/>
              </g>
            </svg>
           
          </a>
        </div>

        <!-- Right - Social Icons -->
        <div class="hidden md:flex flex-col items-end gap-3">
          <!-- Social Label -->
          <div class="flex items-center gap-2 text-gray-500">
            <span class="h-px w-8 bg-gradient-to-r from-transparent to-gray-300"></span>
            <span class="text-sm font-medium">I nostri Social</span>
            <span class="h-px w-8 bg-gradient-to-r from-gray-300 to-transparent"></span>
          </div>

          <!-- Social Icons Wrapper -->
          <div class="w-[180px]"> <!-- Fixed width container -->
            <!-- Social Icons Container -->
            <div class="flex justify-between w-full">
              <!-- Facebook -->
              <a href="https://www.facebook.com/EduNews24.it" class="text-gray-400 transition-colors duration-300 hover:text-[#1877F2]">
                <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 24 24">
                  <path d="M24 12.073c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.99 4.388 10.954 10.125 11.854v-8.385H7.078v-3.47h3.047V9.43c0-3.007 1.792-4.669 4.533-4.669 1.312 0 2.686.235 2.686.235v2.953H15.83c-1.491 0-1.956.925-1.956 1.874v2.25h3.328l-.532 3.47h-2.796v8.385C19.612 23.027 24 18.062 24 12.073z"/>
                </svg>
              </a>

              <!-- Twitter/X -->
              <a href="#" class="text-gray-400 transition-colors duration-300 hover:text-black">
                <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 24 24">
                  <path d="M23.953 4.57a10 10 0 01-2.825.775 4.958 4.958 0 002.163-2.723c-.951.555-2.005.959-3.127 1.184a4.92 4.92 0 00-8.384 4.482C7.69 8.095 4.067 6.13 1.64 3.162a4.822 4.822 0 00-.666 2.475c0 1.71.87 3.213 2.188 4.096a4.904 4.904 0 01-2.228-.616v.06a4.923 4.923 0 003.946 4.827 4.996 4.996 0 01-2.212.085 4.936 4.936 0 004.604 3.417 9.867 9.867 0 01-6.102 2.105c-.39 0-.779-.023-1.17-.067a13.995 13.995 0 007.557 2.209c9.053 0 13.998-7.496 13.998-13.985 0-.21 0-.42-.015-.63A9.935 9.935 0 0024 4.59z"/>
                </svg>
              </a>

              <!-- Instagram -->
              <a href="https://www.instagram.com/edunews_24/" class="text-gray-400 transition-colors duration-300 hover:text-[#E4405F]" target="_blank" rel="noopener noreferrer">
                <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 24 24">
                  <path d="M12 2.163c3.204 0 3.584.012 4.85.07 3.252.148 4.771 1.691 4.919 4.919.058 1.265.069 1.645.069 4.849 0 3.205-.012 3.584-.069 4.849-.149 3.225-1.664 4.771-4.919 4.919-1.266.058-1.644.07-4.85.07-3.204 0-3.584-.012-4.849-.07-3.26-.149-4.771-1.699-4.919-4.92-.058-1.265-.07-1.644-.07-4.849 0-3.204.013-3.583.07-4.849.149-3.227 1.664-4.771 4.919-4.919 1.266-.057 1.645-.069 4.849-.069zm0-2.163c-3.259 0-3.667.014-4.947.072-4.358.2-6.78 2.618-6.98 6.98-.059 1.281-.073 1.689-.073 4.948 0 3.259.014 3.668.072 4.948.2 4.358 2.618 6.78 6.98 6.98 1.281.058 1.689.072 4.948.072 3.259 0 3.668-.014 4.948-.072 4.354-.2 6.782-2.618 6.979-6.98.059-1.28.073-1.689.073-4.948 0-3.259-.014-3.667-.072-4.947-.196-4.354-2.617-6.78-6.979-6.98-1.281-.059-1.69-.073-4.949-.073zm0 5.838c-3.403 0-6.162 2.759-6.162 6.162s2.759 6.163 6.162 6.163 6.162-2.759 6.162-6.163c0-3.403-2.759-6.162-6.162-6.162zm0 10.162c-2.209 0-4-1.79-4-4 0-2.209 1.791-4 4-4s4 1.791 4 4c0 2.21-1.791 4-4 4zm6.406-11.845c-.796 0-1.441.645-1.441 1.44s.645 1.44 1.441 1.44c.795 0 1.439-.645 1.439-1.44s-.644-1.44-1.439-1.44z"/>
                </svg>
              </a>
            </div>
          </div>
        </div>

        <!-- Mobile Menu Button - Only visible on mobile -->
        
      </div>
    </div>
  </div>

  <!-- Navigation -->
  <nav class="border-b border-gray-200 bg-white shadow-md">
    <div class="container mx-auto px-4 overflow-x-auto">
      <ul class="flex whitespace-nowrap">
        {categories.map(category => (
          <li class="group relative">
            <a 
              href={`/${category.slug}`}
              class={`flex items-center px-4 py-3 text-gray-700 hover:text-${category.color} font-medium text-sm uppercase tracking-wide transition-colors`}
            >
              {category.name}
              {category.subcategories && (
                <svg class="w-4 h-4 ml-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
                </svg>
              )}
            </a>
            {category.subcategories && (
              <div class="absolute left-0 top-full bg-white shadow-lg rounded-b border-t border-gray-100 w-48 hidden group-hover:block z-50">
                {category.subcategories.map((sub: any) => (
                  <a 
                    href={`/${category.slug}/${sub.slug}`}
                    class={`block px-4 py-2 text-sm text-gray-700 hover:bg-gray-50 hover:text-${category.color}`}
                  >
                    {sub.name}
                  </a>
                ))}
              </div>
            )}
          </li>
        ))}
        <li>
          <a 
            href="/selezione-personale"
            class="flex items-center px-4 py-3 text-gray-700 hover:text-sport-500 font-medium text-sm uppercase tracking-wide transition-colors"
          >
            Selezione Personale
          </a>
        </li>
        <li>
          <a 
            href="/interpelli"
            class="flex items-center px-4 py-3 text-gray-700 hover:text-sport-500 font-medium text-sm uppercase tracking-wide transition-colors"
          >
            Interpelli
          </a>
        </li>


      </ul>
    </div>
  </nav>

  {isHomePage && (
    <!-- Featured News Slider -->
    <div class="container mx-auto px-4 pt-1">
      <div class="splide" id="featured-slider">
        <div class="splide__track">
          <div class="splide__list">
            {featuredNews.map(news => {
              return (
                <div class="splide__slide">
                  <a href={news.href} class="block">
                    <div class="relative h-[250px] md:h-[400px] group">
                      <img 
                        src={news.image} 
                        alt={news.title}
                        class="w-full h-full object-cover transition-transform duration-300 group-hover:scale-105"
                      />
                      <div class="absolute inset-0 bg-gradient-to-t from-black/80 via-black/50 to-transparent group-hover:from-black/90 transition-all duration-300">
                        <div class="absolute bottom-0 left-0 right-0 p-4 md:p-8 transform transition-transform duration-300 group-hover:translate-y-[-8px]">
                          <h2 class="text-xl md:text-4xl font-bold text-white mb-2 md:mb-3 leading-tight max-w-4xl line-clamp-2 md:line-clamp-none">
                            {news.title}
                          </h2>
                          <p class="text-gray-200 text-sm md:text-xl max-w-3xl hidden sm:block">
                            {news.excerpt}
                          </p>
                        </div>
                      </div>
                    </div>
                  </a>
                </div>
              );
            })}
          </div>
        </div>
      </div>
    </div>
  )}
</header>

<style>
  .breaking-news-ticker {
    mask-image: linear-gradient(
      to right,
      transparent,
      black 10%,
      black 90%,
      transparent
    );
  }

  @keyframes ticker {
    0% { transform: translateX(0); }
    100% { transform: translateX(-100%); }
  }

  .animate-ticker {
    animation: ticker 30s linear infinite;
  }

  .breaking-news-ticker:hover .animate-ticker {
    animation-play-state: paused;
  }

  @keyframes logo-entrance-left {
    0% {
      opacity: 0;
      transform: translateX(-100px) rotateY(180deg) scale(0.8);
      transform-origin: center;
    }
    40% {
      opacity: 1;
      transform: translateX(10px) rotateY(-20deg) scale(1.1);
    }
    60% {
      transform: translateX(-5px) rotateY(10deg) scale(0.95);
    }
    80% {
      transform: translateX(0) rotateY(-5deg) scale(1.02);
    }
    100% {
      opacity: 1;
      transform: translateX(0) rotateY(0) scale(1);
    }
  }

  @keyframes logo-entrance-right {
    0%, 30% {
      opacity: 0;
      transform: translateX(100px) rotateX(180deg) scale(0.8);
      transform-origin: center;
    }
    60% {
      opacity: 1;
      transform: translateX(-10px) rotateX(-20deg) scale(1.1);
    }
    75% {
      transform: translateX(5px) rotateX(10deg) scale(0.95);
    }
    90% {
      transform: translateX(0) rotateX(-5deg) scale(1.02);
    }
    100% {
      opacity: 1;
      transform: translateX(0) rotateX(0) scale(1);
    }
  }

  .animate-logo-entrance-left {
    opacity: 0;
    animation: logo-entrance-left 1.5s cubic-bezier(0.34, 1.56, 0.64, 1) forwards;
    perspective: 1000px;
  }

  .animate-logo-entrance-right {
    opacity: 0;
    animation: logo-entrance-right 2s cubic-bezier(0.34, 1.56, 0.64, 1) forwards;
    perspective: 1000px;
  }
</style>

<script>
  import Splide from '@splidejs/splide';
  import { supabase } from '../lib/supabase';
  
  declare global {
    interface Window {
      supabase: typeof supabase;
    }
  }
  
  window.supabase = supabase;

  async function updateAuthSection() {
    const authSection = document.getElementById('auth-section');
    const logoutContainer = document.getElementById('logout-button-container');
    if (!authSection || !logoutContainer) return;

    const { data: { session } } = await supabase.auth.getSession();
    
    if (!session) {
      authSection.innerHTML = `
        <a href="/login" class="text-sm hover:text-gray-200 flex items-center">
          <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />
          </svg>
          Accedi
        </a>
        <span class="text-gray-400">|</span>
        <a href="/registrati" class="text-sm hover:text-gray-200">Registrati</a>
      `;
      logoutContainer.innerHTML = ''; // Clear logout button when not logged in
      return;
    }

    try {
      const { data: profile, error } = await supabase
        .from('profiles')
        .select('full_name, role')
        .eq('id', session.user.id)
        .single();
      
      if (error) {
        console.error('Error fetching profile:', error);
      }

      const userName = profile?.full_name || session.user.email?.split('@')[0] || 'User';
      const userRole = profile?.role || 'user';

      // Define allowed roles for admin access
      const allowedAdminRoles = ['admin', 'redattore', 'direttore', 'giornalista'];
      const canAccessAdmin = allowedAdminRoles.includes(userRole.toLowerCase());

      // Map roles to display names
      const getRoleDisplay = (role: string) => {
        switch(role.toLowerCase()) {
          case 'docente':
            return 'admin';
          case 'insegnante':
            return 'redattore';
          case 'admin':
            return 'amministratore';
          case 'giornalista':
             return 'giornalista';
          case 'direttore':
             return 'direttore';
          default:
            return role;
        }
      };
      
      // Construct admin button HTML if user has access
      const adminButtonHTML = canAccessAdmin ? `
        <a href="/admin" class="ml-2 text-sm bg-blue-600 hover:bg-blue-700 text-white font-semibold py-1 px-3 rounded-full transition-colors flex items-center">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
            <path stroke-linecap="round" stroke-linejoin="round" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z" />
            <path stroke-linecap="round" stroke-linejoin="round" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
          </svg>
          Admin
        </a>
      ` : '';

      authSection.innerHTML = `
        <div class="flex items-center space-x-2">
          <span class="text-sm font-medium">${userName}</span>
          <span class="text-gray-400">|</span>
          <span class="text-sm text-gray-200 capitalize">${getRoleDisplay(userRole)}</span>
          ${adminButtonHTML} 
        </div>
      `;

      logoutContainer.innerHTML = `
        <button 
          class="bg-white text-sport-500 text-sm px-4 py-1 rounded-full font-medium hover:bg-gray-100 transition-colors"
          id="logout-button"
        >
          Esci
        </button>
      `;

      // Add logout handler with session check
      document.getElementById('logout-button')?.addEventListener('click', async () => {
        try {
          // First check if we have a session
          const { data: { session } } = await supabase.auth.getSession();
          
          if (session) {
            // If we have a session, try to sign out
            const { error } = await supabase.auth.signOut();
            if (error) throw error;
          }
          
          // Clear any auth-related data from localStorage
          for (const key in localStorage) {
            if (key.startsWith('supabase.auth.')) {
              localStorage.removeItem(key);
            }
          }
          
          // Redirect to home page
          window.location.href = '/';
        } catch (e) {
          console.error('Logout failed:', e);
          // If all else fails, force clear storage and redirect
          localStorage.clear();
          window.location.href = '/';
        }
      });

    } catch (e) {
      console.error('Error updating auth section:', e);
    }
  }

  // Initial update
  updateAuthSection();

  // Update on auth state changes
  supabase.auth.onAuthStateChange(() => {
    updateAuthSection();
  });

  document.addEventListener('DOMContentLoaded', function() {
    const featuredSlider = document.getElementById('featured-slider');
    if (featuredSlider) {
      new Splide('#featured-slider', {
        type: 'fade',
        rewind: true,
        autoplay: true,
        interval: 5000,
        arrows: true,
        pagination: true,
        speed: 800,
      }).mount();
    }
  });

  // Duplicate breaking news items for seamless scrolling
  const ticker = document.querySelector('.animate-ticker');
  if (ticker) {
    // Clone the items and append them to create seamless loop
    const items = ticker.innerHTML;
    ticker.innerHTML = items + items;
  }
</script>
